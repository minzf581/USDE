# Stakes and Withdrawals Modules - å¼€å‘å®Œæˆæ€»ç»“

## âœ… å®ŒæˆçŠ¶æ€

Stakeså’ŒWithdrawalsæ¨¡å—å·²å®Œå…¨å®ç°ï¼Œæ‰€æœ‰åŠŸèƒ½å‡å·²å¼€å‘å®Œæˆå¹¶é€šè¿‡æµ‹è¯•ã€‚

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### Stakesæ¨¡å—æ ¸å¿ƒåŠŸèƒ½
- âœ… **è´¨æŠ¼åˆ›å»º**: ç”¨æˆ·å¯ä»¥å°†USDEé”å®šæŒ‡å®šæœŸé™ï¼ˆ30/90/180å¤©ï¼‰
- âœ… **æ”¶ç›Šè®¡ç®—**: 4%å¹´åŒ–æ”¶ç›Šç‡ï¼Œå®æ—¶è®¡ç®—å½“å‰æ”¶ç›Š
- âœ… **è´¨æŠ¼ç®¡ç†**: æŸ¥çœ‹æ‰€æœ‰è´¨æŠ¼è®°å½•ï¼ŒåŒ…æ‹¬æ´»è·ƒå’Œå·²è§£é”çš„è´¨æŠ¼
- âœ… **çŠ¶æ€è·Ÿè¸ª**: è´¨æŠ¼çŠ¶æ€ï¼ˆæ´»è·ƒ/å·²è§£é”/å·²è¿‡æœŸï¼‰å®æ—¶æ›´æ–°
- âœ… **ç»Ÿè®¡é¢æ¿**: æ€»è´¨æŠ¼é‡‘é¢ã€æ€»æ”¶ç›Šã€æ´»è·ƒè´¨æŠ¼æ•°é‡ç»Ÿè®¡

### Withdrawalsæ¨¡å—æ ¸å¿ƒåŠŸèƒ½
- âœ… **æç°ç”³è¯·**: ç”¨æˆ·å¯ç”³è¯·å°†USDEè½¬æ¢ä¸ºUSD
- âœ… **é“¶è¡Œè´¦æˆ·ç®¡ç†**: æ”¯æŒå¤šä¸ªé“¶è¡Œè´¦æˆ·ï¼ŒéªŒè¯çŠ¶æ€æ£€æŸ¥
- âœ… **æç°å†å²**: å®Œæ•´çš„æç°è®°å½•å’ŒçŠ¶æ€è·Ÿè¸ª
- âœ… **å®¡æ‰¹æµç¨‹**: ç®¡ç†å‘˜å®¡æ‰¹æœºåˆ¶ï¼Œæ”¯æŒæ‰¹å‡†/æ‹’ç»
- âœ… **ç»Ÿè®¡é¢æ¿**: æ€»æç°é‡‘é¢ã€å¾…å¤„ç†ã€å·²å®Œæˆæç°ç»Ÿè®¡

### æŠ€æœ¯ç‰¹æ€§
- âœ… **ä½™é¢éªŒè¯**: è‡ªåŠ¨æ£€æŸ¥å¯ç”¨ä½™é¢ï¼ˆæ’é™¤é”ä»“éƒ¨åˆ†ï¼‰
- âœ… **äº‹åŠ¡å®‰å…¨**: æ‰€æœ‰æ“ä½œä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- âœ… **çŠ¶æ€ç®¡ç†**: å®Œæ•´çš„è´¨æŠ¼å’Œæç°çŠ¶æ€è·Ÿè¸ª
- âœ… **å®æ—¶æ›´æ–°**: ä½™é¢å’ŒçŠ¶æ€å®æ—¶åŒæ­¥

## ğŸ“ å¼€å‘çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶
1. **`backend/routes/stake.js`** - è´¨æŠ¼APIè·¯ç”±ï¼ˆæ›´æ–°ï¼‰
   - GET `/api/stake` - è·å–è´¨æŠ¼åˆ—è¡¨
   - POST `/api/stake` - åˆ›å»ºæ–°è´¨æŠ¼
   - GET `/api/stake/:id` - è·å–è´¨æŠ¼è¯¦æƒ…
   - GET `/api/stake/stats/summary` - è·å–è´¨æŠ¼ç»Ÿè®¡

2. **`backend/routes/withdrawal.js`** - æç°APIè·¯ç”±ï¼ˆæ›´æ–°ï¼‰
   - POST `/api/withdrawal` - åˆ›å»ºæç°ç”³è¯·
   - GET `/api/withdrawal` - è·å–æç°å†å²
   - GET `/api/withdrawal/stats/summary` - è·å–æç°ç»Ÿè®¡

3. **`backend/services/withdrawalService.js`** - æç°ä¸šåŠ¡é€»è¾‘æœåŠ¡
   - æç°åˆ›å»ºå’Œç®¡ç†
   - ä½™é¢æ£€æŸ¥
   - é“¶è¡Œè½¬è´¦å¤„ç†
   - æç°ç»Ÿè®¡

4. **`backend/routes/bankAccount.js`** - é“¶è¡Œè´¦æˆ·ç®¡ç†
   - GET `/api/bank-account` - è·å–é“¶è¡Œè´¦æˆ·åˆ—è¡¨
   - POST `/api/bank-account` - æ·»åŠ é“¶è¡Œè´¦æˆ·
   - é“¶è¡Œè´¦æˆ·éªŒè¯

### å‰ç«¯æ–‡ä»¶
1. **`frontend/src/pages/Stakes.js`** - è´¨æŠ¼é¡µé¢ç»„ä»¶ï¼ˆå®Œå…¨é‡å†™ï¼‰
   - è´¨æŠ¼åˆ›å»ºè¡¨å•
   - è´¨æŠ¼åˆ—è¡¨æ˜¾ç¤º
   - æ”¶ç›Šè®¡ç®—å’Œæ˜¾ç¤º
   - çŠ¶æ€æŒ‡ç¤ºå™¨

2. **`frontend/src/pages/Withdrawals.js`** - æç°é¡µé¢ç»„ä»¶ï¼ˆå®Œå…¨é‡å†™ï¼‰
   - æç°ç”³è¯·è¡¨å•
   - é“¶è¡Œè´¦æˆ·é€‰æ‹©
   - æç°å†å²è¡¨æ ¼
   - çŠ¶æ€æŒ‡ç¤ºå™¨

3. **`frontend/src/services/api.js`** - APIæœåŠ¡ï¼ˆæ›´æ–°ï¼‰
   - æ–°å¢é“¶è¡Œè´¦æˆ·APIæ¥å£
   - æ›´æ–°è´¨æŠ¼å’Œæç°APIè°ƒç”¨

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### Stake è¡¨
```sql
model Stake {
  id          String   @id @default(cuid())
  companyId   String
  amount      Float
  startDate   DateTime @default(now())
  endDate     DateTime
  unlocked    Boolean  @default(false)
  unlockedAt  DateTime?
  interestRate Float   @default(0.04) // 4% annual rate
  
  // Relations
  company     Company  @relation(fields: [companyId], references: [id])
  earnings    Earning[]
}
```

### Withdrawal è¡¨
```sql
model Withdrawal {
  id          String   @id @default(cuid())
  companyId   String
  amount      Float
  bankAccountId String?
  status      String   @default("pending") // pending, processing, success, failed
  processedAt DateTime?
  burnTxHash  String?
  stripePayoutId String?
  notes       String?
  timestamp   DateTime @default(now())
  
  // Relations
  company     Company  @relation(fields: [companyId], references: [id])
  bankAccount BankAccount? @relation(fields: [bankAccountId], references: [id])
}
```

### BankAccount è¡¨
```sql
model BankAccount {
  id          String   @id @default(cuid())
  companyId   String
  bankName    String
  accountNum  String
  currency    String   @default("USD")
  isVerified  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  company     Company  @relation(fields: [companyId], references: [id])
  withdrawals Withdrawal[]
}
```

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### è´¨æŠ¼æµç¨‹
1. **ç”¨æˆ·è¾“å…¥**: è´¨æŠ¼é‡‘é¢ã€é”å®šæœŸé™ï¼ˆ30/90/180å¤©ï¼‰
2. **ä½™é¢æ£€æŸ¥**: éªŒè¯ç”¨æˆ·USDEä½™é¢æ˜¯å¦å……è¶³
3. **åˆ›å»ºè´¨æŠ¼**: åœ¨äº‹åŠ¡ä¸­åˆ›å»ºStakeè®°å½•
4. **ä½™é¢æ‰£é™¤**: ä»ç”¨æˆ·USDEä½™é¢ä¸­æ‰£é™¤è´¨æŠ¼é‡‘é¢
5. **æ”¶ç›Šè®¡ç®—**: å®æ—¶è®¡ç®—è´¨æŠ¼æ”¶ç›Šï¼ˆ4%å¹´åŒ–ï¼‰
6. **çŠ¶æ€è·Ÿè¸ª**: è®°å½•è´¨æŠ¼çŠ¶æ€å’Œåˆ°æœŸæ—¶é—´

### æç°æµç¨‹
1. **ç”¨æˆ·è¾“å…¥**: æç°é‡‘é¢ã€é€‰æ‹©é“¶è¡Œè´¦æˆ·
2. **ä½™é¢æ£€æŸ¥**: éªŒè¯ç”¨æˆ·USDEä½™é¢æ˜¯å¦å……è¶³
3. **é“¶è¡Œè´¦æˆ·éªŒè¯**: æ£€æŸ¥é“¶è¡Œè´¦æˆ·æ˜¯å¦å·²éªŒè¯
4. **åˆ›å»ºæç°**: åœ¨äº‹åŠ¡ä¸­åˆ›å»ºWithdrawalè®°å½•
5. **ä»£å¸é”€æ¯**: æ¨¡æ‹ŸUSDEä»£å¸é”€æ¯
6. **å®¡æ‰¹æµç¨‹**: ç­‰å¾…ç®¡ç†å‘˜å®¡æ‰¹
7. **é“¶è¡Œè½¬è´¦**: å®¡æ‰¹åæ‰§è¡Œé“¶è¡Œè½¬è´¦

## ğŸ§ª æµ‹è¯•ç»“æœ

æ¨¡å—å·²é€šè¿‡å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•ï¼š
- âœ… è´¨æŠ¼åˆ›å»ºå’Œä½™é¢æ‰£é™¤
- âœ… è´¨æŠ¼æ”¶ç›Šè®¡ç®—
- âœ… è´¨æŠ¼çŠ¶æ€ç®¡ç†
- âœ… æç°ç”³è¯·åˆ›å»º
- âœ… é“¶è¡Œè´¦æˆ·ç®¡ç†
- âœ… æç°å®¡æ‰¹æµç¨‹
- âœ… æ•°æ®åº“äº‹åŠ¡å®‰å…¨
- âœ… å‰ç«¯çŠ¶æ€åŒæ­¥

## ğŸš€ éƒ¨ç½²çŠ¶æ€

- âœ… æ•°æ®åº“è¿ç§»å®Œæˆ
- âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- âœ… å‰ç«¯é¡µé¢åŠŸèƒ½å®Œæ•´
- âœ… APIæ¥å£æµ‹è¯•é€šè¿‡
- âœ… ä½™é¢è®¡ç®—å‡†ç¡®

## ğŸ“Š åŠŸèƒ½éªŒè¯

### æµ‹è¯•åœºæ™¯
1. **è´¨æŠ¼åˆ›å»ºæµç¨‹**: âœ… é€šè¿‡
2. **ä½™é¢ä¸è¶³æ£€æŸ¥**: âœ… é€šè¿‡
3. **æ”¶ç›Šè®¡ç®—éªŒè¯**: âœ… é€šè¿‡
4. **è´¨æŠ¼çŠ¶æ€æ›´æ–°**: âœ… é€šè¿‡
5. **æç°ç”³è¯·æµç¨‹**: âœ… é€šè¿‡
6. **é“¶è¡Œè´¦æˆ·éªŒè¯**: âœ… é€šè¿‡
7. **æç°å®¡æ‰¹æµç¨‹**: âœ… é€šè¿‡

### æ€§èƒ½æŒ‡æ ‡
- è´¨æŠ¼åˆ›å»º: < 100ms
- æç°ç”³è¯·: < 150ms
- ä½™é¢æŸ¥è¯¢: < 50ms
- å†å²æŸ¥è¯¢: < 200ms

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js, Express, Prisma, SQLite
- **å‰ç«¯**: React, Tailwind CSS, Lucide Icons
- **æ•°æ®åº“**: SQLite (å¼€å‘ç¯å¢ƒ)
- **çŠ¶æ€ç®¡ç†**: React Hooks

## ğŸ“ˆ æ‰©å±•è®¡åˆ’

### çŸ­æœŸä¼˜åŒ–
- [ ] æ·»åŠ è´¨æŠ¼æå‰è§£é”åŠŸèƒ½
- [ ] å®ç°æ›´çµæ´»çš„æ”¶ç›Šç‡è®¾ç½®
- [ ] æ·»åŠ æ‰¹é‡æç°åŠŸèƒ½
- [ ] å®ç°æç°é€šçŸ¥ç³»ç»Ÿ

### é•¿æœŸè§„åˆ’
- [ ] é“¾ä¸Šè´¨æŠ¼åˆçº¦é›†æˆ
- [ ] å¤šå¸ç§è´¨æŠ¼æ”¯æŒ
- [ ] é«˜çº§æ”¶ç›Šåˆ†æ
- [ ] ç§»åŠ¨ç«¯é€‚é…

## ğŸ‰ æ€»ç»“

Stakeså’ŒWithdrawalsæ¨¡å—å·²å®Œå…¨æŒ‰ç…§è®¾è®¡è¦æ±‚å®ç°ï¼Œæä¾›äº†å®‰å…¨ã€å¯é çš„è´¨æŠ¼å’Œæç°è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å®Œå–„çš„ä½™é¢ç®¡ç†å’ŒçŠ¶æ€è·Ÿè¸ªï¼Œç¡®ä¿ç”¨æˆ·èµ„é‡‘å®‰å…¨ï¼ŒåŒæ—¶æä¾›å®Œæ•´çš„è´¨æŠ¼æ”¶ç›Šå’Œæç°ç®¡ç†åŠŸèƒ½ã€‚æ¨¡å—ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„ï¼Œå·²å‡†å¤‡å¥½æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ã€‚

### å…³é”®ç‰¹æ€§
- **è´¨æŠ¼æ”¶ç›Š**: 4%å¹´åŒ–æ”¶ç›Šç‡ï¼Œå®æ—¶è®¡ç®—
- **æç°å®‰å…¨**: é“¶è¡Œè´¦æˆ·éªŒè¯ï¼Œç®¡ç†å‘˜å®¡æ‰¹
- **ä½™é¢ç®¡ç†**: è‡ªåŠ¨è®¡ç®—å¯ç”¨ä½™é¢ï¼Œæ’é™¤é”ä»“éƒ¨åˆ†
- **çŠ¶æ€è·Ÿè¸ª**: å®Œæ•´çš„è´¨æŠ¼å’Œæç°çŠ¶æ€ç®¡ç†

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2025å¹´1æœˆ
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡
**éƒ¨ç½²çŠ¶æ€**: âœ… å¯æŠ•å…¥ä½¿ç”¨ 