# ğŸ”§ ç™»å½•åé”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜æè¿°

ç™»å½•åå‡ºç°å¤šä¸ªAPIç«¯ç‚¹é”™è¯¯ï¼š
1. `/api/auth/profile` - 500é”™è¯¯
2. `/api/dashboard` - 500é”™è¯¯
3. `/api/company/current` - 401é”™è¯¯

## ğŸ” é—®é¢˜åˆ†æ

### 1. æ ¹æœ¬åŸå› 
- **Schemaå­—æ®µä¸åŒ¹é…**: åç«¯ä»£ç ä½¿ç”¨äº†æ—§çš„å­—æ®µåï¼Œä½†æ•°æ®åº“schemaå·²ç»æ›´æ–°
- **ç¼ºå¤±çš„APIç«¯ç‚¹**: æŸäº›ç«¯ç‚¹æ²¡æœ‰æ­£ç¡®å®ç°
- **å­—æ®µå¼•ç”¨é”™è¯¯**: ä»£ç ä¸­å¼•ç”¨äº†ä¸å­˜åœ¨çš„å­—æ®µ

### 2. å…·ä½“é—®é¢˜
1. **æ—§å­—æ®µå**: `ucBalance`, `totalEarnings`, `isActive`, `isEnterpriseAdmin` ç­‰
2. **æ–°å­—æ®µå**: `balance`, `usdeBalance`, `type`, `status` ç­‰
3. **æ•°æ®åº“æŸ¥è¯¢**: å­—æ®µé¡ºåºå’Œç±»å‹ä¸åŒ¹é…

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

### 1. `/api/auth/profile` ç«¯ç‚¹ âœ…
- **é—®é¢˜**: ä½¿ç”¨äº†æ—§çš„å­—æ®µåå’Œselectè¯­å¥
- **ä¿®å¤**: æ”¹ä¸ºç›´æ¥æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼Œç„¶åæ‰‹åŠ¨æ„å»ºå“åº”
- **çŠ¶æ€**: ç°åœ¨æ­£å¸¸å·¥ä½œï¼Œè¿”å›æ­£ç¡®çš„ç”¨æˆ·ä¿¡æ¯

### 2. `/api/company/current` ç«¯ç‚¹ âœ…
- **é—®é¢˜**: ä¹‹å‰ç¼ºå¤±ï¼Œå¯¼è‡´å‰ç«¯æ— é™é‡è¯•
- **ä¿®å¤**: å®ç°äº†å®Œæ•´çš„ç«¯ç‚¹ï¼Œè¿”å›å½“å‰å…¬å¸ä¿¡æ¯
- **çŠ¶æ€**: ç°åœ¨æ­£å¸¸å·¥ä½œ

### 3. Authä¸­é—´ä»¶å…¼å®¹æ€§ âœ…
- **é—®é¢˜**: ä½¿ç”¨äº†æ—§çš„å­—æ®µåè¿›è¡Œæƒé™æ£€æŸ¥
- **ä¿®å¤**: æ›´æ–°äº†æ‰€æœ‰å­—æ®µå¼•ç”¨ï¼Œä½¿ç”¨æ–°çš„schema
- **çŠ¶æ€**: ç°åœ¨æ­£å¸¸å·¥ä½œ

## ğŸš§ ä»éœ€ä¿®å¤çš„é—®é¢˜

### 1. `/api/dashboard` ç«¯ç‚¹ âŒ
- **é—®é¢˜**: ä»ç„¶è¿”å›500é”™è¯¯
- **çŠ¶æ€**: å·²ç®€åŒ–ä»£ç ï¼Œä½†ä»æœ‰é—®é¢˜
- **ä¸‹ä¸€æ­¥**: éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•

### 2. å…¶ä»–è·¯ç”±æ–‡ä»¶
- **é—®é¢˜**: å¯èƒ½è¿˜æœ‰å…¶ä»–ä½¿ç”¨æ—§å­—æ®µåçš„è·¯ç”±
- **çŠ¶æ€**: éœ€è¦å…¨é¢æ£€æŸ¥å’Œä¿®å¤

## ğŸ› ï¸ ä¿®å¤ç­–ç•¥

### 1. å­—æ®µåæ˜ å°„
```javascript
// æ—§å­—æ®µå â†’ æ–°å­—æ®µå
ucBalance â†’ balance
totalEarnings â†’ 0 (æš‚æ—¶)
isActive â†’ status
isEnterpriseAdmin â†’ type === 'enterprise'
role â†’ type
```

### 2. æ•°æ®åº“æŸ¥è¯¢ç­–ç•¥
```javascript
// é¿å…ä½¿ç”¨selectï¼Œç›´æ¥æŸ¥è¯¢æ‰€æœ‰å­—æ®µ
const company = await prisma.company.findUnique({
  where: { id: companyId }
});

// æ‰‹åŠ¨æ„å»ºå“åº”ï¼Œé¿å…å­—æ®µä¸åŒ¹é…
const response = {
  id: company.id,
  name: company.name,
  // ... å…¶ä»–å­—æ®µ
};
```

### 3. é”™è¯¯å¤„ç†
```javascript
// æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•
console.log('Request data:', req.body);
console.log('Company data:', company);
console.log('Response data:', response);
```

## ğŸ“Š å½“å‰çŠ¶æ€

### âœ… å·²ä¿®å¤
- ç™»å½•APIæ­£å¸¸å·¥ä½œ
- `/api/auth/profile` ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- `/api/company/current` ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- Authä¸­é—´ä»¶æ­£å¸¸å·¥ä½œ

### âŒ ä»æœ‰é—®é¢˜
- `/api/dashboard` ç«¯ç‚¹è¿”å›500é”™è¯¯
- å¯èƒ½è¿˜æœ‰å…¶ä»–è·¯ç”±éœ€è¦ä¿®å¤

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### 1. ç«‹å³ä¿®å¤
- è¿›ä¸€æ­¥è°ƒè¯•dashboardç«¯ç‚¹
- æ£€æŸ¥å…¶ä»–å¯èƒ½çš„è·¯ç”±é—®é¢˜

### 2. å…¨é¢æ£€æŸ¥
- æœç´¢æ‰€æœ‰ä½¿ç”¨æ—§å­—æ®µåçš„ä»£ç 
- ä¿®å¤æ‰€æœ‰schemaå…¼å®¹æ€§é—®é¢˜

### 3. æµ‹è¯•éªŒè¯
- æµ‹è¯•æ‰€æœ‰ä¿®å¤åçš„ç«¯ç‚¹
- éªŒè¯å‰ç«¯ç™»å½•æµç¨‹

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤å®Œæˆåï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… æˆåŠŸç™»å½•
- âœ… æ­£å¸¸è®¿é—®å…¬å¸ä¿¡æ¯
- âœ… æŸ¥çœ‹dashboardæ•°æ®
- âœ… ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½æ¨¡å—

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### 1. æ•°æ®åº“å­—æ®µ
```sql
-- å½“å‰Companyè¡¨å­—æ®µ
id: text (NOT NULL)
name: text (NOT NULL)
email: text (NOT NULL)
password: text (NOT NULL)
kycStatus: text (NOT NULL)
usdeBalance: double precision (NOT NULL)
createdAt: timestamp without time zone (NOT NULL)
updatedAt: timestamp without time zone (NOT NULL)
balance: double precision (NOT NULL)
status: text (NOT NULL)
type: text (NOT NULL)
```

### 2. ä¿®å¤æ¨¡å¼
```javascript
// ä¿®å¤å‰
const company = await prisma.company.findUnique({
  where: { id: companyId },
  select: {
    ucBalance: true,        // âŒ æ—§å­—æ®µå
    totalEarnings: true,    // âŒ æ—§å­—æ®µå
    isActive: true          // âŒ æ—§å­—æ®µå
  }
});

// ä¿®å¤å
const company = await prisma.company.findUnique({
  where: { id: companyId }
});

const response = {
  balance: company.balance || 0,           // âœ… æ–°å­—æ®µå
  totalEarnings: 0,                       // âœ… ä¸´æ—¶å€¼
  status: company.status                   // âœ… æ–°å­—æ®µå
};
```

## ğŸŠ æ€»ç»“

æˆ‘ä»¬å·²ç»æˆåŠŸä¿®å¤äº†å¤§éƒ¨åˆ†ç™»å½•åçš„é—®é¢˜ï¼š
1. **ç™»å½•æµç¨‹**: å®Œå…¨æ­£å¸¸
2. **ç”¨æˆ·ä¿¡æ¯**: å¯ä»¥æ­£å¸¸è·å–
3. **å…¬å¸ä¿¡æ¯**: å¯ä»¥æ­£å¸¸è®¿é—®
4. **Dashboard**: ä»éœ€è¿›ä¸€æ­¥è°ƒè¯•

ä¸»è¦é—®é¢˜åœ¨äºæ•°æ®åº“schemaæ›´æ–°åï¼Œåç«¯ä»£ç æ²¡æœ‰åŒæ­¥æ›´æ–°ã€‚é€šè¿‡ä¿®å¤å­—æ®µåå’Œç®€åŒ–æŸ¥è¯¢é€»è¾‘ï¼Œå¤§éƒ¨åˆ†åŠŸèƒ½å·²ç»æ¢å¤æ­£å¸¸ã€‚

ä¸‹ä¸€æ­¥éœ€è¦ç»§ç»­è°ƒè¯•dashboardç«¯ç‚¹ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–éœ€è¦ä¿®å¤çš„è·¯ç”±ã€‚
